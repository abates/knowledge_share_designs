---
sites:
  - name: "{{ site_name }}"
    region__slug: "{{ region.slug }}"
    status__name: "Planned"
    "!ref": "site"

{% macro inventory_item(name, part_id, description) -%}
        - name: "{{ name }}"
          manufacturer__slug: "juniper"
          part_id: "{{ part_id }}"
          description: "{{ description }}"
{% endmacro %}

{% macro device(device_name, lo_address) -%}
    - name: "{{ device_name }}.{{ site_name | lower }}"
      site: "!ref:site"
      device_type__slug: "ptx10016"
      device_role__slug: "core_router"
      status__name: "Planned"
      position: 11
      face: front
      serial: "{{ get_serial_number(device_name) }}"
      inventoryitems:
        {{ inventory_item("CB 0", "JNP10K-RE1", "Second Gen RE1") }}
        {{ inventory_item("CB 1", "JNP10K-RE1", "Second Gen RE1") }}
        {{ inventory_item("SIB 0", "JNP10016-SF3", "Switch Fabric 3") }}
        {{ inventory_item("SIB 1", "JNP10016-SF3", "Switch Fabric 3") }}
        {{ inventory_item("SIB 2", "JNP10016-SF3", "Switch Fabric 3") }}
        {{ inventory_item("SIB 3", "JNP10016-SF3", "Switch Fabric 3") }}
        {{ inventory_item("SIB 4", "JNP10016-SF3", "Switch Fabric 3") }}
        {{ inventory_item("SIB 5", "JNP10016-SF3", "Switch Fabric 3") }}
      interfaces:
        - name: "lo0.0"
          status__name: "Planned"
          type: "virtual"
          ip_addresses:
          - "!create_or_update:address": "{{ lo_address }}"
            status__name: "Reserved"
{% endmacro %}

racks:
  - name: "{{ site_name }}-101"
    site: "!ref:site"
    status__name: "Planned"
    devices:
    {{ device("core01", (site_prefix | network_offset(core_1_loopback_offset))) }}


  - name: "{{ site_name }}-201"
    site: "!ref:site"
    status__name: "Planned"
    devices:
    {{ device("core02", (site_prefix | network_offset(core_2_loopback_offset))) }}
